<html>
	<head>
		<title>River Raid - Javascript</title>
	</head>
	
	<body onLoad="princ()">
		<canvas id="cvs" width="1000" height="600" style="border:1px solid #000000;"></canvas>
		<script>
			var cv = document.getElementById("cvs");
			var  ctxt;
			if (cv.getContext)
				ctxt = cv.getContext("2d");
						
			
			var pontos = 0;
			
			var nvlAtual = 1;
			var totNvls = 10;
			
			//dimensao imgJogador 50x55
			var imgJogador = new Image();
			imgJogador.src = "aviaoSimples.png";
			
			var imgInimigoAviao = new Image();
			imgInimigoAviao.src = "iniAviaoSimples.png";
			
			var jogador_x = cv.width / 2;
			var jogador_y = cv.height * 0.75;
			var jogador_tam = 50;
			var jogador_lar = 15;
			var jogador_vel = 5;
			var jogador_comb = 100.0;
			
			var inimigos = [];
			
			//dimensao imgJogador 50x55
			var tiro_x = jogador_x + (55 / 2);
			var tiro_y = jogador_y;
			
			var mundo_vel = 0.03;
			var inimigo_vel = 0.7;
									
			var moveEsq = false;
			var moveDir = false;
			var atira = false;
			
			var tiro_vel = 5;
			
			
			var _keyDown = function(e)
			{
				switch (e.keyCode)
				{		
					case 37: // seta esquerda
						moveEsq = true;
						break;

					case 39: // seta direita
						moveDir = true;
						break;
					
					case 65:
						atira = true;
						tiro_x = jogador_x;
						tiro_y = jogador_y;
						break;
				}
			}

			var _keyUp = function(e)
			{
				switch (e.keyCode)
				{
					case 37:
						moveEsq = false;
						break;

					case 39:
						moveDir = false;
						break;
				}				
			}

			document.addEventListener("keydown", _keyDown, true);
			document.addEventListener("keyup",   _keyUp,   true);

			inimigos = [{img: imgInimigoAviao, pos_x : 150,	pos_y : 150},{img: imgInimigoAviao,pos_x : 250,pos_y : 650}];
			
			function desInimigos()
			{
				for (var x=0;x<inimigos.length;x++)
				{
					ctxt.drawImage(inimigos[x].img,inimigos[x].pos_x,inimigos[x].pos_y)
					//console.log(inimigos[x]);
				}
			}
			
			function atzInimigos()
			{
				for (var x=0;x<inimigos.length;x++)
				{
					inimigos[x].pos_x += inimigo_vel;
					inimigos[x].pos_y += mundo_vel;
					
					if (inimigos[x].pos_x - inimigos[x].lar < 0 || inimigos[x].pos_x + inimigos[x].lar > 815)
					{	
						inimigo_vel *= -1;
					}				
				}
			}
			
			function atzJogador()
			{
				if (moveEsq)
				{
					jogador_x -= jogador_vel;
					jogador_comb -= 0.05;
				}
				if (moveDir)
				{
					jogador_x += jogador_vel;
					jogador_comb -= 0.05;
				}

				if (jogador_x < 5)
				{
					moveEsq = false;
					jogador_x = 5;
				}
				if (jogador_x > 815)
					jogador_x = 815;				
			}
			
			function posJogador(pos_x,pos_y,imagem)
			{
				ctxt.drawImage(imagem,pos_x,pos_y);
			}
			
			function desJogador()
			{
				posJogador(jogador_x,jogador_y,imgJogador);
			}
			
			function posTiro(pos_x,pos_y)
			{
				ctxt.fillStyle = "black";
				ctxt.fillRect(pos_x + 23,pos_y,5,10);
			}
			
			function desTiro()
			{
				posTiro(tiro_x,tiro_y);
			}
			
			function atzTiro()
			{
				if (atira)
					tiro_y -= tiro_vel;
				if (tiro_y <= 0)
					atira = false;
			}
			
			function desOdometro()
			{
				ctxt.fillStyle = "black";
				ctxt.strokeRect(0,515,cvs.width,cvs.height - 515);
				ctxt.strokeRect(200,525,600,65);
				ctxt.font = "65px Arial";
				ctxt.fillText("E",150,580);
				ctxt.fillText("F",810,580);
			
							
				if (jogador_comb >= 50)
				{
					ctxt.fillStyle = "green";
				}
				else if ((jogador_comb < 50) && (jogador_comb >= 10))
				{
					ctxt.fillStyle = "yellow";
				}
				else
				{
					ctxt.fillStyle = "red";
				}
				
				ctxt.fillRect(201,526,(jogador_comb * 6) ,63);
			}
			
			function infos()
			{
				ctxt.fillStyle = "black";
				ctxt.strokeRect(840,25,150,200);
				ctxt.font = "20px Arial";
				ctxt.fillText("HUD",cvs.width*0.875,50);
				ctxt.fillText("X:" + jogador_x,850,75);
				ctxt.fillText("Y:" + jogador_y,850,100);
				ctxt.fillText("Comb.:" + jogador_comb,850,125);
				ctxt.fillText("Vel Jogador:" + jogador_vel,850,150);
				ctxt.fillText("Vel Mundo:" + mundo_vel,850,175);
				ctxt.fillText("Pontos:" + pontos,850,200);
				
			}
			
			function desenha()
			{
				ctxt.clearRect(0, 0, cvs.width, cvs.height);
				desInimigos();
				desJogador();
				if (atira)
					desTiro();
				infos();
				desOdometro();
			}
			
			function atualiza()
			{
				atzInimigos();
				atzJogador();
				atzTiro();
			}
			
			function princ()
			{
				atualiza();
				desenha();	
				setTimeout(princ,1000);
			}
		</script>
	</body>
</html>

